!function(){!window.Cocoon&&window.cordova&&"undefined"!=typeof require&&cordova.require("cocoon-plugin-common.Cocoon");var e=window.Cocoon;e.define("Cocoon.InApp",function(n){"use strict";function c(e){for(var n=0;n<e.length;++n)i[e[n].productId]=e[n].stock,delete e[n].stock}function t(e,n){var c=i[e];"number"!=typeof c&&(c=0),c+=n,c<0&&(c=0),i[e]=c}function r(e){for(var c=0;c<n._products.length;++c)if(n._products[c].productId===e.productId)return void(n._products[c]=e);n._products.push(e)}n.serviceName="InAppService",n.signal=new e.Signal,n._canPurchase=!0,n._canPurchaseSubscriptions=!0,n._products=[];var i={};return n.initialize=function(t,r){e.exec(this.serviceName,"setListener",[],function(e){var c=e[0];if("start"===c)n.signal.emit("purchase","start",[e[1]]);else if("complete"===c){var t=e[1];i[t.productId]=e[2],n.signal.emit("purchase","complete",[t])}else if("error"==c){var r=e[1],o=e[2];n.signal.emit("purchase","error",[r,o])}}),e.exec(this.serviceName,"initialize",[t],function(e){n._canPurchase=e.canPurchase,n._canPurchaseSubscriptions=e.canPurchaseSubscriptions,n._products=e.products,c(n._products),r&&r(e.error)})},n.Settings={autofinish:"autofinish"},n.canPurchase=function(){return this._canPurchase},n.canPurchaseSubscriptions=function(){return this._canPurchaseSubscriptions},n.fetchProducts=function(n,t){return t=t||function(){},e.exec(this.serviceName,"fetchProducts",[n],function(e){for(var n=0;n<e.length;++n)r(e[n]);c(e),t(e,null)},function(e){t([],e)})},n.getProducts=function(){return this._products},n.productForId=function(e){for(var n=0;n<this._products.length;++n){var c=this._products[n];if(c.productId===e)return c}return null},n.isPurchased=function(e){return this.stockOfProduct(e)>0},n.stockOfProduct=function(e){var n=i[e];return"number"==typeof n?n:0},n.restorePurchases=function(n){n=n||function(){},e.exec(this.serviceName,"restorePurchases",[],function(){n()},function(e){n(e)})},n.purchase=function(n,c,t){"number"!=typeof c&&(c=1),t=t||function(){},e.exec(this.serviceName,"purchase",[n,c],function(){t()},function(e){t(e)})},n.purchaseSubscription=function(n,c){c=c||function(){},e.exec(this.serviceName,"purchaseSubscription",[n,1],function(){c()},function(e){c(e)})},n.consume=function(n,c,r){"number"!=typeof c&&(c=1),r=r||function(){},e.exec(this.serviceName,"consume",[n,c],function(e){t(n,-e),r(e,null)},function(e){r(0,e)})},n.finishPurchase=function(n){e.exec(this.serviceName,"finishPurchase",[n])},n.setValidationHandler=function(c){var t=!c;e.exec(this.serviceName,"setValidationHandler",[t],function(t){var r=t[2];c(t[0],t[1],function(c){e.exec(n.serviceName,"validationCompletion",[r,!!c])})})},n.setLudeiServerValidationHandler=function(){e.exec(this.serviceName,"setLudeiServerValidationHandler",[])},n.Product={productId:"productId",title:"title",description:"description",localizedPrice:"localizedPrice",price:"price",currency:"currency"},n.PurchaseInfo={productId:"productId",transactionId:"transactionId",purchaseDate:"purchaseDate",quantity:"quantity"},n.on=n.signal.expose(),n})}();